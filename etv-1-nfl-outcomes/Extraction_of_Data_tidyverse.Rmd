---
title: "Extraction of Data"
author: "Immanuel Williams PhD"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(rvest)
library(httr)
library(dplyr)
library(stringr)
library(rlang)
library(purrr)
```



## Simplistic Call
```{r}
## Createtion of URL
team_name <- "was"
year <- 2023
generic_url <- paste0("https://www.pro-football-reference.com/teams/",team_name,"/",year,".htm#all_games")
```


```{r}
## Special Note 1: Maybe Optional (Further Research is needed on its relevance)
# request_details <- "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"
# response <- GET(url, user_agent(request_details),timeout(20))
```


```{r}
webpage <- generic_url %>% 
  rvest::read_html()
```


It is giving a memory address pointer instead of the actual data. 
[Can you go deeper on this]
> webpage[[1]]
<pointer: 0x0000022588f6e980>
Warning messages:
1: In xml_child(`__OBJECT__`, 1) : could not find function "xml_child"
2: In xml_child(`__OBJECT__`, 2) : could not find function "xml_child"
> webpage[[2]]
<pointer: 0x0000022584da4070>
> 

From the webpage, grab the HTML tables using rvest html_table()
```{r}
web_tables <- webpage %>% 
  rvest::html_table()
```
The result is a list containing HTML table elements.

Select the desired table, the 2023 Regular Season Table, which is the second table on the webpage. Use purr pluck() to select the table.
[Visit webpage to see available tables]
```{r}
int_web_table <- web_tables %>% 
  purrr::pluck(2)
```

```{r}

inital_col_names <- colnames(int_web_table)

first_row_names <- int_web_table[1,]

new_colnames <- paste(inital_col_names,first_row_names,sep="_") %>% 
  str_trim() %>% 
  str_to_lower() 

new_colnames[6] <- "game_location"

```


```{r}
colnames(int_web_table) <- new_colnames
```






```{r}
mod_4_web_table <- mod_3_web_table %>% 
  mutate(
    # Convert numeric columns
    across(c(week, score_2, score_3, #changed from tm, opp
             starts_with("offense_"), 
             starts_with("defense_"),
             starts_with("expected_points_")), 
           as.numeric))
```

Now, we will use mutate() again to change the game_outcome type to a factor, and use case_when() to make more sense of the game_location column. By identifying when '@' appears, we can change it to away, and the opposite '' as home. We also change this to a factor. Lastly, we filter out the last column which is an aggregate column by filtering out games with no date.
```{r}

mod_5_web_table <- mod_4_web_table  %>% 

  mutate(
    game_outcome = as.factor(game_outcome),
    game_location = case_when(
      game_location == "@" ~ "away",
      game_location == "" ~ "home",
      TRUE ~ game_location
    ) %>% 
      as.factor()
  ) %>% 
  filter(day != "")
```


Finish CLeanign code and Data Frame


Function with Year 


Functions with Year and Team











